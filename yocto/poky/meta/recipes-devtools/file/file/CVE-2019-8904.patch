From 94b7501f48e134e77716e7ebefc73d6bbe72ba55 Mon Sep 17 00:00:00 2001
From: Christos Zoulas <christos@zoulas.com>
Date: Mon, 18 Feb 2019 17:30:41 +0000
Subject: [PATCH] PR/62: spinpx: Avoid non-nul-terminated string read.

Upstream-Status: Backport
CVE: CVE-2019-8904
Affects < 5.36
[Fixup for thud context]
Signed-off-by: Armin Kuster <akuster@mvista.com>

---
 src/readelf.c | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

Index: git/src/readelf.c
===================================================================
--- git.orig/src/readelf.c
+++ git/src/readelf.c
@@ -558,8 +558,8 @@ do_bid_note(struct magic_set *ms, unsign
 	}
 	if (namesz == 4 && strcmp((char *)&nbuf[noff], "Go") == 0 &&
 	    type == NT_GO_BUILD_ID && descsz < 128) {
-		if (file_printf(ms, ", Go BuildID=%s",
-		    (char *)&nbuf[doff]) == -1)
+		if (file_printf(ms, ", Go BuildID=%.*s",
+		    CAST(int, descsz), CAST(char *, &nbuf[doff])) == -1)
 			return 1;
 		return 1;
 	}
